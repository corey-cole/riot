<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>RIOT-Redis</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<link rel="stylesheet" href="./asciidoctor.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>RIOT-Redis</h1>
<div class="details">
<span id="revnumber">version 2.16.1</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">1. Introduction</a></li>
<li><a href="#_getting-started">2. Getting Started</a>
<ul class="sectlevel2">
<li><a href="#_install">2.1. Install</a></li>
<li><a href="#_usage">2.2. Usage</a></li>
</ul>
</li>
<li><a href="#replication">3. Replication</a>
<ul class="sectlevel2">
<li><a href="#replication-usage">3.1. Usage</a></li>
<li><a href="#_source_and_target_options">3.2. Source and target options</a></li>
<li><a href="#_replication_mode">3.3. Replication mode</a></li>
<li><a href="#_replication_type">3.4. Replication type</a></li>
<li><a href="#reader-options">3.5. Reader options</a></li>
<li><a href="#_performance_tuning">3.6. Performance Tuning</a></li>
<li><a href="#_verification">3.7. Verification</a></li>
<li><a href="#_progress">3.8. Progress</a></li>
</ul>
</li>
<li><a href="#_architecture">4. Architecture</a>
<ul class="sectlevel2">
<li><a href="#batch">4.1. Batching</a></li>
<li><a href="#threads">4.2. Multi-threading</a></li>
<li><a href="#_reader">4.3. Reader</a></li>
<li><a href="#live-replication">4.4. Live Replication</a></li>
<li><a href="#dump-and-restore">4.5. Dump &amp; Restore</a></li>
<li><a href="#type-based-replication">4.6. Type-Based Replication</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction"><a class="anchor" href="#_introduction"></a>1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>RIOT-Redis is a data migration tool for Redis.</p>
</div>
<div class="paragraph">
<p>Most Redis migration tools available today are offline in nature.
Migrating data from AWS ElastiCache to Redis Enterprise Cloud for example means backing up your Elasticache data to an AWS S3 bucket and importing it into Redis Enterprise Cloud using its UI.
RIOT-Redis allows for live data migration between any Redis databases.</p>
</div>
<div class="paragraph">
<p>RIOT-Redis does not make use of the <a href="https://redis.io/commands/replicaof">REPLICAOF</a> command which is not always available (see <a href="https://docs.aws.amazon.com/AmazonElastiCache/latest/red-ug/RestrictedCommands.html">ElastiCache restrictions</a>).
Instead it implements <a href="#_architecture">client-side replication</a> using DUMP &amp; RESTORE.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting-started"><a class="anchor" href="#_getting-started"></a>2. Getting Started</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_install"><a class="anchor" href="#_install"></a>2.1. Install</h3>
<div class="paragraph">
<p>RIOT-Redis can be installed in different ways depending on your environment and preference.</p>
</div>
<div class="sect3">
<h4 id="_homebrew_macos"><a class="anchor" href="#_homebrew_macos"></a>2.1.1. Homebrew (macOS)</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="source">brew install redis-developer/tap/riot-redis</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_scoop_windows"><a class="anchor" href="#_scoop_windows"></a>2.1.2. Scoop (Windows)</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="source">scoop bucket add redis-developer https://github.com/redis-developer/scoop.git
scoop install riot-redis</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_download_and_run_linux"><a class="anchor" href="#_download_and_run_linux"></a>2.1.3. Download and run (Linux)</h4>
<div class="paragraph">
<p>RIOT-Redis requires Java and the easiest option is to use the version packaged with Ubuntu.
By default Ubuntu 18.04 includes Open JDK 11.</p>
</div>
<div class="paragraph">
<p>To install this version, first update the package index:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">sudo apt update</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, check if Java is already installed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">java -version</code></pre>
</div>
</div>
<div class="paragraph">
<p>If Java is not currently installed, youâ€™ll see the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">Command 'java' not found, but can be installed with:

sudo apt install default-jre
sudo apt install openjdk-11-jre-headless
sudo apt install openjdk-8-jre-headless</code></pre>
</div>
</div>
<div class="paragraph">
<p>Execute the following command to install the default Java Runtime Environment (JRE), which will install the JRE from OpenJDK 11:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">sudo apt install default-jre</code></pre>
</div>
</div>
<div class="paragraph">
<p>Verify the installation with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">java -version</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see output similar to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">openjdk version &quot;11.0.11&quot; 2021-04-20
OpenJDK Runtime Environment (build 11.0.11+9-Ubuntu-0ubuntu2.18.04)
OpenJDK 64-Bit Server VM (build 11.0.11+9-Ubuntu-0ubuntu2.18.04, mixed mode, sharing))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Download the <a href="https://github.com/redis-developer/riot/releases/latest">latest release</a>, unzip, and copy to the desired location.</p>
</div>
<div class="paragraph">
<p>Now launch the <code>bin/riot-redis</code> script and follow the usage information provided.</p>
</div>
</div>
<div class="sect3">
<h4 id="_docker"><a class="anchor" href="#_docker"></a>2.1.4. Docker</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="source">docker run jruaux/riot-redis [OPTIONS] [COMMAND]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_clone_and_run"><a class="anchor" href="#_clone_and_run"></a>2.1.5. Clone and run</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="source">git clone https://github.com/redis-developer/riot.git
cd riot/bin
./riot-redis</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_usage"><a class="anchor" href="#_usage"></a>2.2. Usage</h3>
<div class="paragraph">
<p>To display usage help, run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="source"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td>
  <td class="code"><pre><span class="green">riot-redis</span> --help
Usage: <strong>riot-redis</strong> [OPTIONS] [COMMAND]
  <span class="olive">-H</span>, <span class="olive">--help</span>                Show this help message and exit
  <span class="olive">-V</span>, <span class="olive">--version</span>             Print version information and exit.
  <span class="olive">-q</span>, <span class="olive">--quiet</span>               Log errors only.
  <span class="olive">-w</span>, <span class="olive">--warn</span>                Set log level to warn.
  <span class="olive">-i</span>, <span class="olive">--info</span>                Set log level to info.
  <span class="olive">-d</span>, <span class="olive">--debug</span>               Log in debug mode (includes normal stacktrace).
      <span class="olive">--stacktrace</span>          Print out the stacktrace for all exceptions.
Redis connection options
  <span class="olive">-h</span>, <span class="olive">--hostname</span>=&lt;host&gt;     Server hostname (default: localhost).
  <span class="olive">-p</span>, <span class="olive">--port</span>=&lt;port&gt;         Server port (default: 6379).
  <span class="olive">-s</span>, <span class="olive">--socket</span>=&lt;socket&gt;     Server socket (overrides hostname and port).
      <span class="olive">--user</span>=&lt;name&gt;         Used to send ACL style 'AUTH username pass'. Needs password.
  <span class="olive">-a</span>, <span class="olive">--pass</span>[=&lt;password&gt;]   Password to use when connecting to the server.
  <span class="olive">-u</span>, <span class="olive">--uri</span>=&lt;uri&gt;...        Server URI.
      --timeout=&lt;sec&gt;       Redis command timeout (default: 60).
  <span class="olive">-n</span>, <span class="olive">--db</span>=&lt;db&gt;             Database number (default: 0).
  <span class="olive">-c</span>, <span class="olive">--cluster</span>             Enable cluster mode.
      <span class="olive">--tls</span>                 Establish a secure TLS connection.
      <span class="olive">--insecure</span>            Allow insecure TLS connection by skipping cert validation.</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Redis connection options are the same as <code>redis-cli</code>.</p>
</div>
<div class="paragraph">
<p>For Redis URI syntax see <a href="https://github.com/lettuce-io/lettuce-core/wiki/Redis-URI-and-connection-details#uri-syntax">here</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can use <code>--help</code> on any subcommand:</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span class="green">riot-redis</span> <span class="red">command</span> --help
<span class="green">riot-redis</span> command <span class="red">subcommand</span> --help</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Available commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">replicate   Replicate a source Redis DB to a target Redis DB
compare     Compare 2 Redis databases and print the differences
info        Display INFO command output
latency     Calculate latency stats
ping        Execute PING command</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="replication"><a class="anchor" href="#replication"></a>3. Replication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>replicate</code> command replicates data from a source Redis database to a target Redis database.</p>
</div>
<div class="sect2">
<h3 id="replication-usage"><a class="anchor" href="#replication-usage"></a>3.1. Usage</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console"><span class="green">riot-redis</span> &lt;source&gt; replicate &lt;target&gt; --mode &lt;snapshot|live&gt; --type &lt;dump|ds&gt; [OPTIONS]</code></pre>
</div>
</div>
<div class="paragraph">
<p>For the full usage, run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console"><span class="green">riot-redis</span> replicate --help</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Snapshot replication example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">riot-redis -h source -p 6379 replicate -h target -p 6380 --batch 10</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Live replication example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">riot-redis --info -h source -p 6379 replicate -h target -p 6380 --mode live</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_source_and_target_options"><a class="anchor" href="#_source_and_target_options"></a>3.2. Source and target options</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>-h &lt;host&gt;</code></dt>
<dd>
<p>Redis server hostname</p>
</dd>
<dt class="hdlist1"><code>-p &lt;port&gt;</code></dt>
<dd>
<p>Redis server port</p>
</dd>
<dt class="hdlist1"><code>--cluster</code></dt>
<dd>
<p>Enable cluster mode</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_replication_mode"><a class="anchor" href="#_replication_mode"></a>3.3. Replication mode</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>--mode snapshot</code></dt>
<dd>
<p>Initial replication using key scan</p>
</dd>
<dt class="hdlist1"><code>--mode liveonly</code></dt>
<dd>
<p>Continuous replication using keyspace notifications (only keys that change are replicated)</p>
</dd>
<dt class="hdlist1"><code>--mode live</code></dt>
<dd>
<p>Initial + continuous replication using key scan and keyspace notifications in parallel</p>
</dd>
</dl>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Make sure the source database has keyspace notifications enabled using <code>notify-keyspace-events = KA</code> in <code>redis.conf</code> or via CONFIG SET.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_replication_type"><a class="anchor" href="#_replication_type"></a>3.4. Replication type</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>--type dump</code></dt>
<dd>
<p>DUMP on source, RESTORE on target</p>
</dd>
<dt class="hdlist1"><code>--type ds</code></dt>
<dd>
<p><a href="#type-based-replication">Type-based replication</a></p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="reader-options"><a class="anchor" href="#reader-options"></a>3.5. Reader options</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>--scan-count</code></dt>
<dd>
<p>How many keys to read at once on each call to <a href="https://redis.io/commands/scan#the-count-option">SCAN</a></p>
</dd>
<dt class="hdlist1"><code>--scan-match</code></dt>
<dd>
<p>Pattern of keys to replicate (default: <code>*</code> i.e. all keys)</p>
</dd>
<dt class="hdlist1"><code>--scan-type</code></dt>
<dd>
<p>Type of keys to replicate (default: all types)</p>
</dd>
<dt class="hdlist1"><code>--reader-threads</code></dt>
<dd>
<p>How many value reader threads to use in parallel</p>
</dd>
<dt class="hdlist1"><code>--reader-batch</code></dt>
<dd>
<p>Number of keys each reader thread should dump at once in a pipelined call</p>
</dd>
<dt class="hdlist1"><code>--reader-queue</code></dt>
<dd>
<p>Max number of items that reader threads can put in the shared queue.</p>
<div class="paragraph">
<p>When the queue is full reader threads wait for space to become available.</p>
</div>
<div class="paragraph">
<p>Queue size should be at least <strong>#threads * batch</strong>, for example <code>--reader-threads 4 --reader-batch 500</code> &#8658; <code>--reader-queue 2000</code></p>
</div>
</dd>
<dt class="hdlist1"><code>--reader-pool</code></dt>
<dd>
<p>Size of the connection pool shared by reader threads.</p>
<div class="paragraph">
<p>Can be smaller than the number of threads</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_performance_tuning"><a class="anchor" href="#_performance_tuning"></a>3.6. Performance Tuning</h3>
<div class="paragraph">
<p>Performance tuning is an art but RIOT-Redis offers some facilities to identify potential bottlenecks.
In addition to the <a href="#batch">batch</a> and <a href="#threads">threads</a> options you have the <code>--dry-run</code> option which disables writing to the target Redis database so that you can tune <a href="#reader-options">reading</a> in isolation.
Add that option to your existing <code>replicate</code> command-line to compare replication speeds with and without writing to the target Redis database:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">riot-redis ... replicate ... --dry-run</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_verification"><a class="anchor" href="#_verification"></a>3.7. Verification</h3>
<div class="paragraph">
<p>Once replication is complete RIOT-Redis will perform a verification step by iterating over keys in the source database and comparing values and TTLs between source and target databases.</p>
</div>
<div class="paragraph">
<p>The verification step happens automatically after the scan is complete (snapshot replication), or for live replication when keyspace notifications have become idled (see <a href="#replication-usage">replication usage</a>).</p>
</div>
<div class="paragraph">
<p>Verification can also be run on-demand using the <code>compare</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">riot-redis -h &lt;left host&gt; -p &lt;left port&gt; compare -h &lt;right host&gt; -p &lt;right port&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt;1,234 T2,345 â‰ 3,456 â§—4,567 &lt;5,678</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>&gt;</code>: # keys only present in source database</p>
</li>
<li>
<p><code>T</code>: # mismatched data structure types</p>
</li>
<li>
<p><code>â‰ </code>: # mismatched values</p>
</li>
<li>
<p><code>â§—</code>: # keys with TTL delta greater than tolerance</p>
</li>
<li>
<p><code>&lt;</code>: # keys only present in target database</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To show which keys are different use the <code>--show-diffs</code> option:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">riot-redis ... compare ... --show-diffs</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_progress"><a class="anchor" href="#_progress"></a>3.8. Progress</h3>
<div class="paragraph">
<p>Each process (scan, and event listener in case of live replication) has a corresponding status bar that shows the process name and its progress:
* Scanning: percentage of keys that have been replicated &#8658; replicated / total. The total number of keys is calculated when the process starts and it can change by the time it is finished (for example in case keys are deleted or added during the replication), so the progress bar is only a rough indicator.
* Listening: progress is indefinite as total number of keys is unknown</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_architecture"><a class="anchor" href="#_architecture"></a>4. Architecture</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="architecture.svg" alt="architecture">
</div>
</div>
<div class="paragraph">
<p>RIOT-Redis processes data in batch fashion: a fixed number of records (batch AKA chunk) is read, processed, and written at a time.
Then the cycle is repeated until there&#8217;s no more data on the source.</p>
</div>
<div class="sect2">
<h3 id="batch"><a class="anchor" href="#batch"></a>4.1. Batching</h3>
<div class="paragraph">
<p>The default batch size is 50, which means that an execution step reads 50 items at a time from the source, processes them, and finally writes then to the target.
If the target is Redis, writing is done in a single command <a href="https://redis.io/topics/pipelining">pipeline</a> to minimize the number of roundtrips to the server.</p>
</div>
<div class="paragraph">
<p>You can change the batch size (and hence pipeline size) using the <code>--batch</code> option.
The optimal batch size in terms of throughput depends on a few factors like record size and command types (see <a href="https://stackoverflow.com/a/32165090">here</a> for details).</p>
</div>
</div>
<div class="sect2">
<h3 id="threads"><a class="anchor" href="#threads"></a>4.2. Multi-threading</h3>
<div class="paragraph">
<p>It is possible to parallelize processing by using multiple threads.
In that configuration, each chunk of items is read, processed, and written in a separate thread of execution.</p>
</div>
<div class="paragraph">
<p>To set the number of threads use the <code>--threads</code> option.</p>
</div>
</div>
<div class="sect2">
<h3 id="_reader"><a class="anchor" href="#_reader"></a>4.3. Reader</h3>
<div class="imageblock">
<div class="content">
<img src="reader-architecture.svg" alt="reader architecture">
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Scan for keys in the source Redis database.
If live replication is enabled the reader also subscribes to keyspace notifications to generate a continuous stream of keys.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Reader threads iterate over the keys to read corresponding values and TTLs.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Reader threads enqueue key/value/TTL tuples into the reader queue, from which the writer dequeues key/value/TTL tuples and writes them to the target Redis database.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="live-replication"><a class="anchor" href="#live-replication"></a>4.4. Live Replication</h3>
<div class="paragraph">
<p>In live replication mode RIOT-Redis listens for changes happening on the source database using keyspace notifications.
Each time a key is modified, RIOT-Redis reads the corresponding value and propagates that change to the target database.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The live replication mechanism does not guarantee data consistency.
Redis sends keyspace notifications over pub/sub which does not provide guaranteed delivery.
It is possible that RIOT-Redis can miss some notifications in case of network failures for example.</p>
</div>
<div class="paragraph">
<p>Also, depending on the type, size, and rate of change of data structures on the source it is possible that RIOT-Redis cannot keep up with the change stream.
For example if a big set is repeatedly updated, RIOT-Redis will need to read the whole set on each update and transfer it over to the target database.
With a big-enough set, RIOT-Redis could fall behind and the internal queue could fill up leading up to updates being dropped.
Some preliminary sizing using Redis statistics and big-keys is recommended for these migrations.
If you need assistance please contact your Redis account team.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="dump-and-restore"><a class="anchor" href="#dump-and-restore"></a>4.5. Dump &amp; Restore</h3>
<div class="paragraph">
<p>The default replication mechanism in RIOT-Redis is DUMP &amp; RESTORE:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="dump-and-restore.svg" alt="dump and restore">
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Key reader: initiates a SCAN and optionally calls SUBSCRIBE to listen for keyspace notifications (live replication).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Value reader: takes the keys and calls DUMP and TTL.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Key/Value writer: takes key/value/ttl tuples and calls RESTORE and EXPIRE.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="type-based-replication"><a class="anchor" href="#type-based-replication"></a>4.6. Type-Based Replication</h3>
<div class="paragraph">
<p>If the target Redis database does not support the RESTORE command (e.g. <a href="https://redis.com/redis-enterprise/technology/active-active-geo-distribution/">CRDB</a>), RIOT-Redis includes another type of replication where each Redis data structure type has a corresponding pair of read/write commands:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Read</th>
<th class="tableblock halign-left valign-top">Write</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Hash</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">HGETALL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HSET</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">List</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">LRANGE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RPUSH</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Set</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMEMBERS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SADD</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Sorted Set</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZRANGE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZADD</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Stream</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">XRANGE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">XADD</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">String</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SET</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>To select this replication mechanism pass <code>--type ds</code> option to the <code>replicate</code> command:</p>
</div>
<div class="listingblock">
<div class="title">Type-based, live replication example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">riot-redis -h source -p 6379 replicate -h target -p 6380 --type ds --mode live</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
This replication strategy is more intensive in terms of CPU, memory, and network for the machines running RIOT-Redis.
Adjust number of threads, batch, and queue sizes accordingly.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 2.16.1<br>
Last updated 2022-07-22 05:55:19 UTC
</div>
</div>
<link rel="stylesheet" href="./coderay-asciidoctor.css">
</body>
</html>